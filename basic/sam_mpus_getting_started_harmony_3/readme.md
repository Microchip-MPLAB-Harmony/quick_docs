---
title: Getting Started with MPLAB Harmony v3 on the SAMA5D2
parent: Harmony Basics
has_toc: false
nav_order: 17
---

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<img src="../../r_images/quick_home.png" title="Home">](../../readme.md) [<img src="../../r_images/quick_back.png"  title="Back">](../readme.md)
## Getting started with MPLAB® Harmony 3 on the SAMA5D2

The SAMA5D2's ROM boot loader looks for a second stage boot loader in external NVM, relocates it to internal SRAM, and executes it. Harmony uses the AT91Bootstrap as its second stage boot loader. The AT91Bootstrap initializes clocks, PIO, and DDR prior to relocating the application image from NVM to DDR and starting it.

As of the 3.2 release of Harmony only loading the AT91bootstrap and Harmony application from an external SD card has been tested. To boot your Harmony application for the SD card, first format the card with the FAT file system.
Next, download the AT91Bootstrap binary from <a href="https://github.com/Microchip-MPLAB-Harmony/at91bootstrap/blob/master/boot.bin" target="_blank">here</a>  and place the boot.bin on the SD card.

The next step is to download the Harmony 3 framework. This process can be automated using the MPLAB® Harmony Framework Management Tool. First clone the MHC repository found <a href="https://github.com/Microchip-MPLAB-Harmony/contentmanager" target="_blank">here</a>  and launch the harmony-content-manager.jar
>`java -jar harmony-content-manager.jar`.

The downloader will clone the Harmony 3 repositories that you select.

NOTE: From here on when the document references launching MHC it refers to the mhc.jar file downloaded by the content manager with the mhc repository, along with the rest of the Harmony Framework.

### Launching an Existing Project

Demo applications can be found in the apps directory in each Harmony repository
downloaded.  To load the demo application in MHC run:
>`java -jar mhc.jar -fw"=(path to where you downloaded harmony)" -mode=gui -c="(path to harmony.prj file associated with the demo application you'd like to run. e.g. ../csp/apps/uart/uart_echo_interrupt/firmware/src/config/sam_a5d2_xult/harmony.prj)"`

**NOTE: MHC must be launched from inside the mhc directory.  You can't be in another directory and give a path to mhc.jar, you must be inside the same directory as the mhc.jar file or MHC won't run correctly.**

**Make sure the firmware path (-fw=) contains a trailing directory separator (/ on Linux, \ on Windows)**

This will launch the existing project in MHC. For documentation on the demo applications shipped with Harmony refer to the github.io pages for the repository containing the app you'd like to run (e.g. <a href="https://microchip-mplab-harmony.github.io/csp" target="_blank"> csp</a>) . Once the project is loaded the code can be regenerated by selecting
>`Generate->Generate Code` 

from the menu.  

The IAR project has already been created for any demo applications and can be opened by opening (demo application's firmware directory)/sam\_a5d2\_xult.IAR/(project name).eww. Once IAR is launched simply build the application and load the harmony.bin image as described below.

### Creating a New Project

Once you've cloned the Harmony 3 framework launch MHC by running:
>`java -jar mhc.jar -fw="(path to where you downloaded harmony)" -mode=gui`.

With the MHC running create a new Harmony project under
>`File->New Configuration`.

<img src = "images/project_configuration.png" align="middle"> 

NOTES:
1. As of the 3.2 release using relative paths in MHC causes issues when
   generating code.  Please uncheck the box marked "Convert to Relative Path for
   Configuration"
2. The diff tool should be configured immediately after tool install, before
   code generation is attempted, otherwise User changes may be lost.
   1. Select File > Preferences from the menu.
   2. Enter the pathname to the executable file for your preferred "diff" tool
      and click Close.  (Pass command line arguments as {0} {1} and so on.)

Add the desired plibs, drivers, and system services your application requires
and configure them accordingly, then generate the code.

To compile your project launch IAR Embedded Workbench for ARM.  (Harmony has
been tested with version 8.30.1 of IAR EW.)  Make sure you have IAR
configured to use project connections by going to
>`Tools->Options->Project->Enable project connections`.

<img src = "images/project_connections.png" align="middle"> 

Create a new empty project in a new direcotry under the firmware directory created by MHC (e.g. `HarmonyProjects/myApp/firmware/sam_a5d2_xult.IAR/myApp_sam_a5d2_xult.ewp`).

<img src = "images/new_project.png" align="middle"> 

Under the Project menu bar select 
>`Add Project Connection`

<img src = "images/add_connection.png" align="middle"> 

Browse to the ipcf file MHC generated.

<img src = "images/ipcf_browse.png" align="middle"> 

Since the AT91Bootstrap is looking to load a raw binary, we need to have IAR
convert the ELF it builds into a raw binary.  Right click on the project name
and select options.  Under Output Converter select the 
>`Generate additional output`

box, select Raw binary as the Output format, select the 
>`Override default`

box and type 
>`harmony.bin` 

in the text field.

<img src = "images/output_converter.png" align="middle"> 

Now build your application.  Once the application is built copy the harmony.bin
file that was generated to the SD card.  Insert the SD card into the board, apply
power, and your Harmony application should boot and run.

#### Debugging your application:
IAR supports source-level debugging of your application.  First connect the SAM-ICE JTAG debugger to the JTAG header on the development board. Go to
>`Options->Debugger`

and select
>`J-Link/J-Trace`

as the Driver.  If the application
has booted from the SD card, simply load your project in IAR and select
>`Project->Attach to Running Target`

This will allow you to halt the running
program, set breakpoints, view and change memory and registers, etc.

## Note
<span style="color:blue"> *This page has been verified with the following versions of software tools:*</span>  

 - [MPLAB Harmony v3 "csp" repo v3.7.1](https://github.com/Microchip-MPLAB-Harmony/csp/releases/tag/v3.7.1)
 - [MPLAB Harmony v3 "dev_packs" repo v3.7.0](https://github.com/Microchip-MPLAB-Harmony/dev_packs/releases/tag/v3.7.0)
 - [MPLAB Harmony v3 "mhc" repo v3.4.0](https://github.com/Microchip-MPLAB-Harmony/mhc/releases/tag/v3.4.0)
 - MPLAB Harmony Configurator Plugin v3.5.0
 - [MPLAB X IDE v5.40](https://www.microchip.com/mplab/mplab-x-ide)
 - [MPLAB XC32 Compiler v2.41](https://www.microchip.com/mplab/compilers)

<span style="color:blue"> Because Microchip regularly update tools, occasionally there could be minor differences with the newer versions of the tools. </span>  

## Reference Links
[<a href="https://www.microchip.com/design-centers/32-bit" target="_blank"> <img src="../../r_images/32_bit_mcus.png"> </a>]()  &nbsp; &nbsp; &nbsp; [<a href="https://www.microchip.com/design-centers/32-bit-mpus" target="_blank"> <img src="../../r_images/32_bit_mpus.png"> </a>]()  &nbsp; &nbsp; &nbsp; [<a href="https://www.microchip.com/mplab/mplab-x-ide" target="_blank"> <img src="../../r_images/mplab_x_ide.png"> </a>]()  &nbsp; &nbsp; [<a href="https://www.microchip.com/mplab/mplab-harmony" target="_blank"> <img src="../../r_images/mplab_harmony.png"> </a>]() [<a href="https://www.microchip.com/mplab/compilers" target="_blank"> <img src="../../r_images/mplab_compiler.png"> </a>]()  